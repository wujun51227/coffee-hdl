#########################################################3
# Design
#########################################################3
class SubModule extends Module
  constructor: ->
    super()
    Mixin importLib('verilog_helpers.chdl')
    Port(
      dout: output(16)
    )
    @moduleParameter([
      { key:'hello',value:100}
    ])

    Mem(
      mem: vec(10,20)
    )

  build: ->
    assign @dout = @getParameter('hello')

    initial
      $sequence()
      .init =>
        @readmemh(@getParameter('hello'),@mem)
      .end()

class ParameterTest extends Module
  u0_cell: new SubModule()

  constructor: ->
    super()
    Mixin importLib('verilog_helpers.chdl')
    Port()

    @u0_cell.instParameter([
      { key:'hello',value:200}
    ])

    Channel(
      ch: channel()
    )

    @u0_cell.bind(
      dout: @ch
    )

  build: ->
    initial
      $sequence()
      .delay(100) =>
        @readmemh('hello',@u0_cell.mem)
        @assert_eq(@ch,200,'test parameter')
        @assert_report()
        @sim_finish()
      .end()

module.exports=ParameterTest

