bus=importLib('./bus_protocol.chdl')

class master_cell extends Module
  constructor: ->
    super()
    Mixin importLib('verilog_helpers.chdl')
    Port(
      master: bus.master()
    )

  build: ->
    v=vreg()
    assign @master.valid  = v

    initial
      $sequence()
      .init =>
        assign v = 0
      .delay(1000) =>
      .delay(100) =>
        assign v = 1
      .delay(100) =>
        assign v = 0
      .delay(100) =>
        assign v = 1
      .delay(100) =>
        assign v = 0
      .end()

    initial
      $sequence()
      .delay(10) =>
        @assert_1(@master.ready,'check 1')
      .delay(1110) =>
        @assert_0(@master.ready,'check 0')
      .delay(1210) =>
        @assert_1(@master.ready,'check 1')
      .delay(1310) =>
        @assert_0(@master.ready,'check 0')
      .delay(1410) =>
        @assert_1(@master.ready,'check 1')
      .end()

module.exports=master_cell
