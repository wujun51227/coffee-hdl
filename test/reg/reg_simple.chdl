#########################################################3
# Design
#########################################################3

class RegSimple extends Module
  constructor: ->
    super()

    Port(
      hclk: input().asClock()
      rstn: input().asReset()
      dout: output(5).fromReg('ff1')
      din: input(9)
      clear: input()
      aa:
        bb:
          asreg: output(9).asReg({noReset:true})
    )

    Reg(
      ff1: reg(5).init(0).clock('hclk').syncReset('rstn')
      ff2: reg(6).init(100).clock('hclk').noReset()
      ff3: reg(7).init(0xff).clock('hclk').highReset().clear('clear')
      ff4: reg(8).clock('hclk').syncReset('rstn').highReset()
      ff5: reg(9)
      ff6: reg(9)
    )


  build: ->
    assign(@ff6) = $ @ff5.fromMsb(8)

    always
      $if(@ff1)
        assign(@aa.bb.asreg) = $ 100
      $endif

    pass_always
      assign(@ff5) = $ @aa.bb.asreg

    always
      assign(@ff5)
        $if(@ff2)
          $ @aa.bb.asreg
        $elseif(@ff3)
          $if(@ff4)
            $ @aa.bb.asreg+1
          $else
            $ 32\h123
          $endif
        $else
          $ 32\h456
        $endif

module.exports=RegSimple

